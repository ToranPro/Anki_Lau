<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>UET Flashcards v4 (Th√¥ng Minh)</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        text-align: center;
        background-color: #f0f2f5;
        padding: 20px;
        color: #333;
      }

      /* CSS Card */
      .card-container {
        perspective: 1000px;
        margin: 20px auto;
        width: 300px;
        height: 200px;
        cursor: pointer;
      }
      .card {
        width: 100%;
        height: 100%;
        position: relative;
        transform-style: preserve-3d;
        transition: transform 0.6s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        border-radius: 15px;
      }
      .card.is-flipped {
        transform: rotateY(180deg);
      }

      .card-face {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: bold;
        border-radius: 15px;
        flex-direction: column;
        padding: 10px;
      }
      .card-front {
        background: white;
        color: #333;
      }
      .card-back {
        background: #4caf50;
        color: white;
        transform: rotateY(180deg);
      }

      /* N√∫t ƒëi·ªÅu khi·ªÉn */
      .controls {
        margin-top: 20px;
        display: flex;
        justify-content: center;
        gap: 15px;
      }
      .btn {
        padding: 12px 20px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
        font-weight: bold;
        color: white;
      }

      /* M√†u n√∫t ƒë√°nh gi√° */
      .btn-forgot {
        background: #dc3545;
      } /* ƒê·ªè */
      .btn-remember {
        background: #28a745;
      } /* Xanh l√° */
      .btn-voice {
        background: #ff9800;
      } /* Cam */

      .btn:active {
        transform: scale(0.95);
        opacity: 0.9;
      }

      /* Add Section */
      .add-section {
        margin-top: 40px;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      input {
        padding: 10px;
        margin: 5px;
        width: 80%;
        border: 1px solid #ddd;
        border-radius: 5px;
      }

      .status-bar {
        margin-bottom: 15px;
        font-size: 14px;
        color: #666;
      }
      .level-badge {
        background: #eee;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 12px;
        margin-top: 5px;
      }
    </style>
  </head>
  <body>
    <h2>üß† App H·ªçc Th√¥ng Minh</h2>

    <div class="status-bar">
      C·∫ßn h·ªçc h√¥m nay: <b id="dueCount" style="color: red">0</b> th·∫ª
    </div>

    <div class="card-container" onclick="latThe()">
      <div class="card" id="flashcard">
        <div class="card-face card-front">
          <span id="frontContent">Loading...</span>
          <span class="level-badge" id="levelDisplay">Lv.0</span>
        </div>
        <div class="card-face card-back" id="backContent">...</div>
      </div>
    </div>

    <div class="controls" id="reviewButtons">
      <button class="btn btn-forgot" onclick="danhGia(false)">‚ùå Qu√™n</button>
      <button class="btn btn-voice" onclick="docTu(event)">üîä</button>
      <button class="btn btn-remember" onclick="danhGia(true)">‚úÖ Nh·ªõ</button>
    </div>

    <hr style="margin: 30px 0; border: 0; border-top: 1px solid #ccc" />

    <div class="add-section">
      <h3>‚ûï Th√™m th·∫ª m·ªõi</h3>
      <input type="text" id="newFront" placeholder="M·∫∑t tr∆∞·ªõc" />
      <input type="text" id="newBack" placeholder="M·∫∑t sau" />
      <br />
      <button
        class="btn"
        style="background: #007bff; margin-top: 10px"
        onclick="themThe()"
      >
        L∆∞u Th·∫ª
      </button>
      <button
        class="btn"
        style="background: #6c757d; margin-top: 10px"
        onclick="resetAll()"
      >
        ‚ôªÔ∏è Reset H·ªçc L·∫°i
      </button>
    </div>

    <script>
      let fullDatabase = []; // Ch·ª©a t·∫•t c·∫£ th·∫ª
      let studyQueue = []; // Ch·ªâ ch·ª©a th·∫ª c·∫ßn h·ªçc h√¥m nay
      let currentCard = null; // Th·∫ª ƒëang hi·ªán tr√™n m√†n h√¨nh

      const cardElement = document.getElementById("flashcard");
      const frontEl = document.getElementById("frontContent");
      const backEl = document.getElementById("backContent");
      const levelEl = document.getElementById("levelDisplay");
      const dueCountEl = document.getElementById("dueCount");

      // --- 1. KH·ªûI T·∫†O ---
      function initApp() {
        const savedData = localStorage.getItem("myFlashcards_v4");
        if (savedData) {
          fullDatabase = JSON.parse(savedData);
        } else {
          // D·ªØ li·ªáu m·∫´u n·∫øu m·ªõi d√πng l·∫ßn ƒë·∫ßu
          fullDatabase = [
            {
              id: 1,
              front: "Hello",
              back: "Xin ch√†o",
              level: 0,
              nextReview: 0,
            },
            {
              id: 2,
              front: "Thank you",
              back: "C·∫£m ∆°n",
              level: 0,
              nextReview: 0,
            },
          ];
        }
        locTheCanHoc();
      }

      // --- 2. LOGIC L·ªåC TH·∫∫ (TR√ÅI TIM C·ª¶A APP) ---
      function locTheCanHoc() {
        const now = Date.now();

        // L·ªçc ra nh·ªØng th·∫ª c√≥ th·ªùi gian review <= hi·ªán t·∫°i
        studyQueue = fullDatabase.filter((card) => {
          if (!card.nextReview) return true; // Th·∫ª m·ªõi ch∆∞a h·ªçc bao gi·ªù
          return card.nextReview <= now;
        });

        updateUI();
      }

      // --- 3. C·∫¨P NH·∫¨T GIAO DI·ªÜN ---
      function updateUI() {
        dueCountEl.innerText = studyQueue.length;

        if (studyQueue.length === 0) {
          // N·∫øu h·∫øt th·∫ª ƒë·ªÉ h·ªçc
          frontEl.innerText = "üéâ ƒê√£ xong!";
          backEl.innerText = "H·∫øt th·∫ª c·∫ßn h·ªçc h√¥m nay r·ªìi.";
          levelEl.style.display = "none";
          cardElement.classList.remove("is-flipped");
          document.getElementById("reviewButtons").style.visibility = "hidden"; // ·∫®n n√∫t ƒë√°nh gi√°
          currentCard = null;
          return;
        }

        // L·∫•y th·∫ª ƒë·∫ßu ti√™n trong h√†ng ƒë·ª£i ra h·ªçc
        currentCard = studyQueue[0];

        document.getElementById("reviewButtons").style.visibility = "visible";
        levelEl.style.display = "inline-block";
        cardElement.classList.remove("is-flipped");

        setTimeout(() => {
          frontEl.innerText = currentCard.front;
          backEl.innerText = currentCard.back;
          levelEl.innerText = "Lv." + (currentCard.level || 0);
        }, 200);
      }

      // --- 4. X·ª¨ L√ù ƒê√ÅNH GI√Å (QU√äN / NH·ªö) ---
      function danhGia(nho) {
        if (!currentCard) return;

        const now = Date.now();
        const oneDay = 24 * 60 * 60 * 1000; // Millisecond trong 1 ng√†y

        if (nho) {
          // N·∫æU NH·ªö: TƒÉng Level, ƒë·∫©y ng√†y h·ªçc ra xa
          currentCard.level = (currentCard.level || 0) + 1;

          // C√¥ng th·ª©c ƒë∆°n gi·∫£n: Level 1 = 1 ng√†y, Level 2 = 2 ng√†y, Level 3 = 4 ng√†y...
          // B·∫°n c√≥ th·ªÉ ch·ªânh s·ªë n√†y t√πy √Ω
          let daysToAdd = Math.pow(2, currentCard.level - 1);
          currentCard.nextReview = now + daysToAdd * oneDay; // T√≠nh th·ªùi ƒëi·ªÉm ti·∫øp theo
        } else {
          // N·∫æU QU√äN: V·ªÅ Level 0, h·ªçc l·∫°i ngay l·∫≠p t·ª©c (ho·∫∑c sau 1 ph√∫t)
          currentCard.level = 0;
          currentCard.nextReview = now; // Set l√† hi·ªán t·∫°i ƒë·ªÉ t√Ω n·ªØa n√≥ xu·∫•t hi·ªán l·∫°i
        }

        // L∆∞u d·ªØ li·ªáu c·∫≠p nh·∫≠t v√†o m·∫£ng g·ªëc
        saveToStorage();

        // N·∫øu "Nh·ªõ" -> Lo·∫°i kh·ªèi h√†ng ƒë·ª£i h√¥m nay. N·∫øu "Qu√™n" -> Gi·ªØ l·∫°i ho·∫∑c ƒë·∫©y xu·ªëng cu·ªëi
        locTheCanHoc();
      }

      function latThe() {
        if (currentCard) cardElement.classList.toggle("is-flipped");
      }

      function themThe() {
        const front = document.getElementById("newFront").value;
        const back = document.getElementById("newBack").value;
        if (front && back) {
          fullDatabase.push({
            id: Date.now(), // ID duy nh·∫•t
            front: front,
            back: back,
            level: 0,
            nextReview: 0, // 0 nghƒ©a l√† c·∫ßn h·ªçc ngay
          });
          saveToStorage();
          document.getElementById("newFront").value = "";
          document.getElementById("newBack").value = "";
          locTheCanHoc(); // C·∫≠p nh·∫≠t l·∫°i list
          alert("ƒê√£ th√™m!");
        }
      }

      function saveToStorage() {
        localStorage.setItem("myFlashcards_v4", JSON.stringify(fullDatabase));
      }

      // H√†m ph·ª• ƒë·ªÉ reset data n·∫øu mu·ªën test l·∫°i t·ª´ ƒë·∫ßu
      function resetAll() {
        if (confirm("B·∫°n mu·ªën reset t·∫•t c·∫£ th·∫ª v·ªÅ tr·∫°ng th√°i ch∆∞a h·ªçc?")) {
          fullDatabase.forEach((card) => {
            card.level = 0;
            card.nextReview = 0;
          });
          saveToStorage();
          locTheCanHoc();
        }
      }

      function docTu(event) {
        event.stopPropagation();
        if (!currentCard) return;
        let isBack = cardElement.classList.contains("is-flipped");
        let text = isBack ? currentCard.back : currentCard.front;
        let lang = isBack ? "vi-VN" : "en-US";
        let u = new SpeechSynthesisUtterance(text);
        u.lang = lang;
        window.speechSynthesis.speak(u);
      }

      initApp();
    </script>
  </body>
</html>
